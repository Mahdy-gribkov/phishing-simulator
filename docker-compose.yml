services:
  app:
    build: .
    ports:
      - "8080:8080"
    env_file: .env
    volumes:
      - ./dkim-private.pem:/app/dkim-private.pem:ro

  # Local dev: docker compose --profile dev up
  mailpit:
    image: axllent/mailpit:latest
    ports:
      - "1025:1025"
      - "8025:8025"
    profiles: [dev]

  app-dev:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SMTP_MODE=relay
      - SMTP_HOST=mailpit
      - SMTP_PORT=1025
      - SMTP_USER=
      - SMTP_PASS=
      - SMTP_SENDER_EMAIL=donaldtrump@whitehouse.gov
      - SMTP_SENDER_NAME=Donald Trump
      - SMTP_ENVELOPE_SENDER=donaldtrump@whitehouse.gov
      - INSECURE_SKIP_VERIFY=true
    depends_on: [mailpit]
    profiles: [dev]
